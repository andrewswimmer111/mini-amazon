{% import '_macros.html' as macros %}

<div id="products-container">

  <div class="product-grid">

    {% for product in avail_products %}
      <div class="product-card">

        <!-- IMAGE -->
        <a href="{{ url_for('items.view_product', product_id=product.id) }}">
          {% if product.image %}
            <img class="product-image" src="{{ product.image }}" alt="{{ product.name }}">
          {% else %}
            <div class="product-image placeholder">No Image</div>
          {% endif %}
        </a>

        <!-- NAME -->
        <div class="product-name">
          <a href="{{ url_for('items.view_product', product_id=product.id) }}">
            {{ product.name }}
          </a>
        </div>

        <!-- DESCRIPTION -->
        <div class="product-desc">
          {{ product.description }}
        </div>

        <!-- PRICE -->
        <div class="product-price">
          {% if product.min_price and product.max_price %}
            ${{ '%.2f'|format(product.min_price) }} — ${{ '%.2f'|format(product.max_price) }}
          {% else %}
            <span class="text-muted">N/A</span>
          {% endif %}
        </div>

        <!-- CATEGORY + SELLER -->
        <div class="product-meta">
          <div><strong>Category:</strong> {{ product.category }}</div>
          <div><strong>Created By:</strong> {{ product.created_by or '—' }}</div>
        </div>

      </div>
    {% endfor %}

  </div>

  <!-- PAGINATION (unchanged) -->
  {% if pages is defined and pages > 1 %}
    <nav aria-label="Product pages">
      <ul class="pagination">

        <!-- Previous -->
        <li class="page-item {% if page <= 1 %}disabled{% endif %}">
          {% if page > 1 %}
            <a class="page-link"
              hx-get="{{ macros.url_with_page(page-1) }}"
              hx-target="#products-container"
              hx-swap="outerHTML">Previous</a>
          {% else %}
            <span class="page-link">Previous</span>
          {% endif %}
        </li>

        {% set start = page - 2 if page - 2 > 1 else 1 %}
        {% set end = page + 2 if page + 2 < pages else pages %}

        {% if start > 1 %}
          <li class="page-item">
            <a class="page-link"
              hx-get="{{ macros.url_with_page(1) }}"
              hx-target="#products-container"
              hx-swap="outerHTML">1</a>
          </li>
          {% if start > 2 %}
            <li class="page-item disabled"><span class="page-link">…</span></li>
          {% endif %}
        {% endif %}

        {% for pnum in range(start, end + 1) %}
          <li class="page-item {% if pnum == page %}active{% endif %}">
            <a class="page-link"
              hx-get="{{ macros.url_with_page(pnum) }}"
              hx-target="#products-container"
              hx-swap="outerHTML">{{ pnum }}</a>
          </li>
        {% endfor %}

        {% if end < pages %}
          {% if end < pages - 1 %}
            <li class="page-item disabled"><span class="page-link">…</span></li>
          {% endif %}
          <li class="page-item">
            <a class="page-link"
              hx-get="{{ macros.url_with_page(pages) }}"
              hx-target="#products-container"
              hx-swap="outerHTML">{{ pages }}</a>
          </li>
        {% endif %}

        <li class="page-item {% if page >= pages %}disabled{% endif %}">
          {% if page < pages %}
            <a class="page-link"
              hx-get="{{ macros.url_with_page(page+1) }}"
              hx-target="#products-container"
              hx-swap="outerHTML">Next</a>
          {% else %}
            <span class="page-link">Next</span>
          {% endif %}
        </li>
      </ul>

      <div class="mt-2 pagination">
        Showing page {{ page }} of {{ pages }} — {{ total }} results
      </div>
    </nav>
  {% endif %}

</div>
