{% extends "base.html" %}

{% block content %}

<br><br>
{% if current_user.is_authenticated %}
  <a href="{{ url_for('cart.view_cart') }}" class="btn btn-primary mb-3">View Cart</a>
{% endif %}

<h2>View a Sellerâ€™s Inventory</h2>
<form id="seller-form" onsubmit="goToSeller(event)">
  <label for="seller-id">Enter Seller ID:</label>
  <input 
    type="number" 
    id="seller-id" 
    name="seller_id" 
    min="0" 
    placeholder="e.g. 0"
    required
  >
  <button type="submit">View Inventory</button>
</form>

<br><br>

<h2>Products for sale:</h2>

<form method="get" action="{{ url_for('index.index') }}">

  <label for="category">Category:</label>
  <select id="category" name="category">
    <option value="" {% if not selected_category %}selected{% endif %}>All</option>
    {% for c in categories %}
      <option value="{{ c }}" {% if selected_category == c %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select>

  <label for="keyword">Keyword:</label>
  <input 
    type="text" 
    id="keyword" 
    name="keyword" 
    placeholder="Search"
    value="{{ keyword or '' }}"
  >

  <label for="minPrice">Min Price:</label>
  <input 
    type="number" 
    id="minPrice" 
    name="minPrice" 
    step="0.01"
    min="0"
    value="{{ minPrice or '' }}"
  >

  <label for="maxPrice">Max Price:</label>
  <input 
    type="number" 
    id="maxPrice" 
    name="maxPrice" 
    step="0.01"
    min="0"
    value="{{ maxPrice or '' }}"
  >

  <label for="sortBy">Sort by:</label>
  <select id="sortBy" name="sortBy">
    <option value="price" {% if sortBy == 'price' %}selected{% endif %}>Price</option>
    <option value="name" {% if sortBy == 'name' %}selected{% endif %}>Name</option>
  </select>

  <select id="sortDir" name="sortDir">
    <option value="asc" {% if sortDir == 'asc' %}selected{% endif %}>Ascending</option>
    <option value="desc" {% if sortDir == 'desc' %}selected{% endif %}>Descending</option>
  </select>

  <button type="submit">Apply</button>
  <button type="button" id="reset-btn" data-url="{{ url_for('index.index') }}">
    Reset
  </button>
</form>

{% include '_products_fragment.html' %}

<br><br>

<script>
  document.getElementById('reset-btn').addEventListener('click', (e) => {
    window.location.href = e.target.dataset.url;
  });

  function goToSeller(event) {
    event.preventDefault();
    const id = document.getElementById('seller-id').value.trim();
    if (id !== '') {
      // redirect to the seller inventory view
      window.location.href = `/seller/${id}/inventory/view`;
    }
  }
</script>

{% endblock %}