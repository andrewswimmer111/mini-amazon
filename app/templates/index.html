{% extends "base.html" %}

{% block content %}

<br><br>

<h2>Products for sale:</h2>

{% if current_user.is_authenticated %}
  <a href="{{ url_for('cart.view_cart') }}" class="btn btn-primary mb-3">View Cart</a>
{% endif %}


<div> Filters </div>
<form method="get" action="{{ url_for('index.index') }}">

  <label for="category">Category:</label>
  <select id="category" name="category">
    <option value="" {% if not selected_category %}selected{% endif %}>All</option>
    {% for c in categories %}
      <option value="{{ c }}" {% if selected_category == c %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select>

  <label for="keyword">Keyword:</label>
  <input 
    type="text" 
    id="keyword" 
    name="keyword" 
    placeholder="Search"
    value="{{ keyword or '' }}"
  >

  <label for="minPrice">Min Price:</label>
  <input 
    type="number" 
    id="minPrice" 
    name="minPrice" 
    step="0.01"
    min="0"
    value="{{ minPrice or '' }}"
  >

  <label for="maxPrice">Max Price:</label>
  <input 
    type="number" 
    id="maxPrice" 
    name="maxPrice" 
    step="0.01"
    min="0"
    value="{{ maxPrice or '' }}"
  >

  <label for="sortBy">Sort by:</label>
  <select id="sortBy" name="sortBy">
    <option value="price" {% if sortBy == 'price' %}selected{% endif %}>Price</option>
    <option value="name" {% if sortBy == 'name' %}selected{% endif %}>Name</option>
  </select>

  <select id="sortDir" name="sortDir">
    <option value="asc" {% if sortDir == 'asc' %}selected{% endif %}>Ascending</option>
    <option value="desc" {% if sortDir == 'desc' %}selected{% endif %}>Descending</option>
  </select>

  <label for="limit">Limit:</label>
  <input
    type="number"
    id="limit"
    name="limit"
    value="{{ limit or '' }}"
    min="1"
    max="{{ n }}"
    step="1"
  >

  <button type="submit">Apply</button>
  <button type="button" id="reset-btn" data-url="{{ url_for('index.index') }}">
    Reset
  </button>
</form>

<br><br>

<br><br>
<h2>View a Sellerâ€™s Inventory</h2>

<form id="seller-form" onsubmit="goToSeller(event)">
  <label for="seller-id">Enter Seller ID:</label>
  <input 
    type="number" 
    id="seller-id" 
    name="seller_id" 
    min="0" 
    placeholder="e.g. 0"
    required
  >
  <button type="submit">View Inventory</button>
</form>

<script>
  function goToSeller(event) {
    event.preventDefault();
    const id = document.getElementById('seller-id').value.trim();
    if (id !== '') {
      // redirect to the seller inventory view
      window.location.href = `/seller/${id}/inventory/view`;
    }
  }
</script>

<br><br>

<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Product Description</th>
      <th scope="col">Product Category</th>
      <th scope="col">Price</th>
      <th scope="col">Add</th>
    </tr>
  </thead>
  <tbody>
    {% for product in avail_products%}
      <tr>
        <th scope="row">{{product.id}}</th>
        <td>{{product.name}}</td>
        <td>{{product.description}}</td>
        <td>{{product.category}}</td>
        <td>{{product.price}}</td>
        <td>
          {% if current_user.is_authenticated %}
            <form method="post" action="{{ url_for('cart.add_to_cart') }}" style="display:inline-block">
              <input type="hidden" name="product_id" value="{{ product.id }}">
              <input type="number" name="quantity" value="1" min="1" style="width:70px" aria-label="quantity">
              <button type="submit" class="btn btn-sm btn-success">Add</button>
            </form>
          {% else %}
            <a href="{{ url_for('users.login') }}">Log in to add</a>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  document.getElementById('reset-btn').addEventListener('click', (e) => {
    window.location.href = e.target.dataset.url;
  });
</script>

{% endblock %}