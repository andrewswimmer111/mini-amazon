{% extends "base.html" %}

{% block content %}

<div>
    <h3> Product details </h3>
    <div> ID: {{ product.id }} </div>
    <div> Name: {{ product.name }}</div>
    <div> Description: {{ product.description }}</div>
    {% if product.image %}
    <div> 
        Image: <br>
        <img src="{{ product.image }}" alt="{{ product.name }}" style="max-width: 300px; max-height: 300px;">
    </div>
    {% endif %}
    <div> Category: {{ product.category }} </div>
    {% if product.created_by %}
    <div> Created By: User ID {{ product.created_by }} </div>
    {% endif %}
</div>
<a href="{{ url_for('items.edit_product', product_id=product.id) }}" class="btn btn-outline-primary">Edit Product</a>

<br><br>

<div>
  <h3>Available from Sellers</h3>

  {% if inventory %}
    <table class='table table-hover table-bordered container'>
      <thead class="thead-dark">
        <tr>
          <th scope="col">Seller ID</th>
          <th scope="col">Price</th>
          <th scope="col">Quantity Available</th>
          <th scope="col">Add to Cart</th>
        </tr>
      </thead>
      <tbody>
        {% for i in inventory %}
          <tr>
            <td>{{ i.seller_id }}</td>
            <td>${{ "%.2f"|format(i.price) }}</td>
            <td>{{ i.quantity }}</td>
            <td>
              {% if current_user.is_authenticated %}
                {% if i.quantity > 0 %}
                  <form method="post" action="{{ url_for('cart.add_to_cart') }}" style="display:inline-block">
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <input type="hidden" name="seller_id" value="{{ i.seller_id }}">
                    <input type="number" name="quantity" value="1" min="1" max="{{ i.quantity }}" style="width:70px" aria-label="quantity">
                    <button type="submit" class="btn btn-sm btn-success">Add to Cart</button>
                  </form>
                {% else %}
                  <span class="text-muted">Out of Stock</span>
                {% endif %}
              {% else %}
                <a href="{{ url_for('users.login') }}">Log in to add</a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div>No sellers currently offering this product</div>
  {% endif %}
</div>

{% endblock %}